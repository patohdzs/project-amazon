option limrow = 0;
option limcol = 0;
option solprint = off;

set T /0*200/;
set R /1*78/;
set Y /1*200/;
set S /1*16/;
alias(S,S1);
 
set dep(T,S,S1) /
    0.2.1   0.3.1   0.4.1   0.5.1   0.6.1   0.7.1   0.8.1   0.9.1   0.10.1  0.11.1  0.12.1  0.13.1  0.14.1  0.15.1  0.16.1 
    1.2.1   1.3.1   1.4.1   1.5.1   1.6.1   1.7.1   1.8.1   1.10.9  1.11.9  1.12.9  1.13.9  1.14.9  1.15.9  1.16.9
    2.2.1   2.3.1   2.4.1   2.6.5   2.7.5   2.8.5   2.10.9  2.11.9  2.12.9  2.14.13 2.15.13 2.16.13 
    3.2.1   3.4.3   3.6.5   3.8.7   3.10.9  3.12.11 3.14.13 3.16.15    
/;

scalar scale / 1.0e11 /;

scalar p_a_low / 32.44 /;
scalar p_a_high / 42.78 /;

parameter scenario(Y) ;
$call csv2gdx mc_1.csv id=scenario index=1 values=2..lastCol useHeader=y trace=0
$gdxIn mc_1.gdx
$load  scenario
$gdxIn 
display scenario;

parameter prob(S);


parameter prob_low(S) /
1 0.3440086892251979
2 0.10517818723082013
3 0.006253013017814979
4 0.13108264992699692
5 0.006253013017814979
6 0.0019118138423357177
7 0.0077930751421337666
8 0.1633671540105098
9 0.006253013017814979
10 0.0019118138423357177
11 0.00011366041912786541
12 0.0023826767813606643
13 0.007793075142133767
14 0.0023826767813606643
15 0.009712441026096749
16 0.20360304757614595
/;

parameter prob_high(S) /
1 0.020451871900453337
2 0.006253013017814979
3 0.00037175171801692887
4 0.007793075142133767
5 0.00037175171801692887
6 0.00011366041912786542
7 0.00046331089739768273
8 0.009712441026096749
9 0.025488988118758302
10 0.007793075142133768
11 0.00046331089739768273
12 0.009712441026096749
13 0.03176670177089271
14 0.009712441026096749
15 0.03959056109638916
16 0.829941605083177
/;

parameter x0(R);
$call csv2gdx X0Data.csv id=x0  index=1 values=2..lastCol useHeader=y trace=0
$gdxIn X0Data.gdx
$load  x0
$gdxIn 
display x0;


parameter z0(R);
$call csv2gdx Z0Data.csv id=z0  index=1 values=2..lastCol useHeader=y trace=0
$gdxIn Z0Data.gdx
$load  z0
$gdxIn 
display z0;

parameter zbar(R);
$call csv2gdx ZbarData.csv id=zbar  index=1 values=2..lastCol useHeader=y trace=0
$gdxIn ZbarData.gdx
$load  zbar
$gdxIn 
display zbar;

parameter gamma(R);

$call csv2gdx GammaData.csv id=gamma  index=1 values=2..lastCol useHeader=y trace=0
$gdxIn GammaData.gdx
$load  gamma 
$gdxIn

display gamma;




parameter theta(R);
$call csv2gdx ThetaData.csv id=theta  index=1 values=2..lastCol useHeader=y trace=0
$gdxIn ThetaData.gdx
$load  theta 
$gdxIn
display theta;

parameter delta / 0.02 /;

parameter p_e ;
$gdxIn %myDB%
$load p_e
$gdxIn

table p_a(S,T) 
	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	29	30	31	32	33	34	35	36	37	38	39	40	41	42	43	44	45	46	47	48	49	50	51	52	53	54	55	56	57	58	59	60	61	62	63	64	65	66	67	68	69	70	71	72	73	74	75	76	77	78	79	80	81	82	83	84	85	86	87	88	89	90	91	92	93	94	95	96	97	98	99	100	101	102	103	104	105	106	107	108	109	110	111	112	113	114	115	116	117	118	119	120	121	122	123	124	125	126	127	128	129	130	131	132	133	134	135	136	137	138	139	140	141	142	143	144	145	146	147	148	149	150	151	152	153	154	155	156	157	158	159	160	161	162	163	164	165	166	167	168	169	170	171	172	173	174	175	176	177	178	179	180	181	182	183	184	185	186	187	188	189	190	191	192	193	194	195	196	197	198	199	200
1	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
2	32.44	32.44	32.44	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
3	32.44	32.44	32.44	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
4	32.44	32.44	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
5	32.44	32.44	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
6	32.44	32.44	42.78	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
7	32.44	32.44	42.78	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
8	32.44	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
9	32.44	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
10	32.44	42.78	32.44	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
11	32.44	42.78	32.44	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
12	32.44	42.78	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
13	32.44	42.78	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
14	32.44	42.78	42.78	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78
15	32.44	42.78	42.78	42.78	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44	32.44
16	32.44	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78	42.78;

parameter alpha / 0.045007414 /;
parameter kappa / 2.094215255 /;
parameter zeta / 1.66e-04 /;

parameter x_agg(S,T);
parameter z_agg(S,T);
parameter u_agg(S,T);
parameter v_agg(S,T);
parameter c_agg(S,T);
parameter objval(S);

positive variable z(S,T,R);
positive variable u(S,T,R);
positive variable v(S,T,R);
         variable x(S,T,R);
         variable w(S,T);
         variable obj;

equation zdot_def(S,T,R);
equation xdot_def(S,T,R);
equation w_def(S,T);
equation non_x_def(T,S,S1,R);
equation non_z_def(T,S,S1,R);
equation non_u_def(T,S,S1,R);
equation non_v_def(T,S,S1,R);
equation non_w_def(T,S,S1);
equation obj_def;

zdot_def(S,T,R)$(ord(T) < card(T))..
  z(S,T+1,R) - z(S,T,R) =e= u(S,T,R) - v(S,T,R);

xdot_def(S,T,R)$(ord(T) < card(T))..
  x(S,T+1,R) - x(S,T,R) =e= -gamma(R)*u(S,T,R) - alpha*x(S,T,R) + alpha*gamma(R)*(zbar(R)/scale - z(S,T,R));

w_def(S,T)$(ord(T) < card(T))..
  w(S,T) =e= sum(R, u(S,T,R) + v(S,T,R));

non_x_def(dep(T,S,S1),R)..
  x(S,T,R) =e= x(S1,T,R);

non_z_def(dep(T,S,S1),R)..
  z(S,T,R) =e= z(S1,T,R);

non_u_def(dep(T,S,S1),R)..
  u(S,T,R) =e= u(S1,T,R);

non_v_def(dep(T,S,S1),R)..
  v(S,T,R) =e= v(S1,T,R);

non_w_def(dep(T,S,S1))..
  w(S,T) =e= w(S1,T);

obj_def..
  obj =e= sum(S, prob(S)*sum(T$(ord(T) < card(T)), exp(-delta*(ord(T)-1))*(-p_e*sum(R, kappa*z(S,T+1,R) - (x(S,T+1,R) - x(S,T,R))) + p_a(S,T)*sum(R, theta(R)*z(S,T+1,R)) - scale*zeta/2*sqr(w(S,T)))));

model amazon / all /;

file results / 25sites_output_dynamic_200.dat /;
file regionresults / 25sites_output_regions_dynamic_200.dat /;
file regionresults_x / "amazon_data_x.dat" /;
file regionresults_w / "amazon_data_w.dat" /;
file regionresults_z / "amazon_data_z.dat" /;
file regionresults_u / "amazon_data_u.dat" /;
file regionresults_v / "amazon_data_v.dat" /;

results.nr = 2;
regionresults.nr = 2;
regionresults.pw = 16384;

x.l(S,T,R)$(ord(T) = 1) = x0(R) / scale;
z.l(S,T,R)$(ord(T) = 1) = z0(R) / scale;
z.up(S,T,R)$(ord(T) > 1) = zbar(R) / scale;




loop(Y,
* fix boundary values

  x.fx(S,T,R)$(ord(T) = 1) = x.l(S,T,R);
  z.fx(S,T,R)$(ord(T) = 1) = z.l(S,T,R);
  u.fx(S,T,R)$(ord(T) = card(T)) = 0;
  v.fx(S,T,R)$(ord(T) = card(T)) = 0;
  w.fx(S,T)$(ord(T) = card(T)) = 0;

* update the probabilities based on the actual scenario
* update the initial prices based on the actual scenario

  prob(S) = prob_low(S)$(scenario(Y) = 1) + prob_high(S)$(scenario(Y) = 2);
  p_a(S,'0') = p_a_low$(scenario(Y) = 1) + p_a_high$(scenario(Y) = 2);
  
  option qcp = cplex;
  solve amazon using qcp maximizing obj;

* output the results
  x_agg(S,T) = scale*sum(R, x.l(S,T,R));
  z_agg(S,T) = scale*sum(R, z.l(S,T,R));
  u_agg(S,T) = scale*sum(R, u.l(S,T,R));
  v_agg(S,T) = scale*sum(R, v.l(S,T,R));
  c_agg(S,T) = scale*scale*sum(R, u.l(S,T,R)*v.l(S,T,R));
  objval(S) = sum(T$(ord(T) < card(T)), exp(-delta*(ord(T)-1))*(-p_e*sum(R, kappa*z.l(S,T+1,R) - (x.l(S,T+1,R) - x.l(S,T,R))) + p_a(S,T)*sum(R, theta(R)*z.l(S,T+1,R)) - scale*zeta/2*sqr(w.l(S,T))));

  put results;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(S,
    put // 'S = ' S.tl:4 '  obj = ' objval(S) //;
    put 'T':4 system.tab 'x_agg':10 system.tab 'z_agg':10 system.tab 'u_agg':10 system.tab 'v_agg':10 system.tab 'c_agg':10 /;
    loop(T, 
      put T.tl:4 system.tab x_agg(S,T):10:6 system.tab z_agg(S,T):10:6 system.tab u_agg(S,T):10:6 system.tab v_agg(S,T):10:6 system.tab c_agg(S,T):10:6 /
    );
  );

* output region, x0, z0, u0, v0
  put regionresults_z;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(R, 
    put system.tab (z.l('1','0',R)*scale):10:6 /
  );
  
  put regionresults_x;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(R, 
    put system.tab (x.l('1','0',R)*scale):10:6 /
  );
  
  put regionresults_u;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(R, 
    put system.tab (u.l('1','0',R)*scale):10:6 /
  );  


  put regionresults_v;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(R, 
    put system.tab (v.l('1','0',R)*scale):10:6 /
  );

  put regionresults_w;
  put // 'Y = ' Y.tl:4 '  p_a = ' p_a('1','0') //;
  loop(R, 
    put system.tab (w.l('1','0')*scale):10:6 /
  );

$ontext
  loop(S,
    put // 'S = ' S.tl:4 '  obj = ' objval(S) //;
    put 'T/R':4;
    loop(R, 
      put system.tab R.tl:10
    );
    put /;
    loop(T,
      put T.tl:4;
      loop(R, 
        put system.tab (scale*z.l(S,T,R)):10:6);
      put /;
    );
  );
$offtext

* update based on the dynamics
* the updated x and z have the correct values from the nonanticipativity constraints
* the updated u and v would not satisfy the nonanticipativity constraints for the next round
  x.l(S,T,R)$(ord(T)<card(T)) = x.l(S,T+1,R);
  z.l(S,T,R)$(ord(T)<card(T)) = z.l(S,T+1,R);
* u.l(S,T,R)$(ord(T)<card(T)) = u.l(S,T+1,R);
* v.l(S,T,R)$(ord(T)<card(T)) = v.l(S,T+1,R);
* w.l(S,T)$(ord(T)<card(T)) = w.l(S,T+1);
);

putclose results;
putclose regionresults_z;
putclose regionresults_x;
putclose regionresults_u;
putclose regionresults_v;
putclose regionresults_w;